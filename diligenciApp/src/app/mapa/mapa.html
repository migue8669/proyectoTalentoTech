<div class="map-container">
  <div class="header">
<div class="brand">
  <div class="logo-text">
   <input type="checkbox" checked enable class="logo-check" />
    <span class="logo-name">DiligenciApp</span>
  </div>
      <p class="logo-tagline">Diligencias y Servicios</p>

</div>
    <div class="btn-group" role="group" aria-label="Basic mixed styles example">
      <button
        type="button"
        class="btn btn-outline-info"
        (click)="toggleVista()"
        title="Alternar vista"
      >
        {{ mostrarMuro ? 'Mapa' : 'Muro' }}
      </button>
      <button
        type="button"
        class="btn btn-outline-primary"
        (click)="loadMarkers()"
        title="Recargar marcadores"
      >
        &#x27F3;
      </button>
      <button
        type="button"
        class="btn btn-outline-secondary"
        (click)="logout()"
        title="Cerrar sesi贸n"
      >
        X
      </button>
    </div>
  </div>

  <google-map
    *ngIf="mostrarMapa"
    height="450px"
    width="100%"
    [options]="mapOptions"
    [center]="center"
    [zoom]="zoom"
  >
    <map-marker
      *ngFor="let marker of markerPositions; trackBy: trackByMarkerId"
      #markerElem="mapMarker"
      [position]="{ lat: marker.lat, lng: marker.lng }"
      [title]="marker.titulo"
      (mapClick)="openInfoWindow(marker, markerElem, infoWindow)"
    ></map-marker>

    <map-info-window #infoWindow="mapInfoWindow">
      <div class="info-window" *ngIf="selectedMarker">
        <!-- T铆tulo y detalles -->
        <strong>{{ selectedMarker.titulo }}</strong>
        <span>Servicio: {{ selectedMarker.servicio }}</span>
        <span>Categoria: {{ selectedMarker.categoria }}</span>
                <span>Precio: {{ selectedMarker.precio }}</span>

        <span>Tel茅fono: {{ selectedMarker.telefono }}</span>
        <small> {{ selectedMarker.direccion }}</small>

        <!-- SECCIN DE ESTADO (Separada del bot贸n de acci贸n) -->
        <div
          class="status-section mt-2"
          [ngClass]="{
            'bg-green-100 text-green-300': selectedMarker.estado?.toUpperCase() === 'DISPONIBLE',
            'bg-yellow-100 text-yellow-300': selectedMarker.estado?.toUpperCase() === 'TOMADO',
            'bg-gray-100 text-gray-300': selectedMarker.estado?.toUpperCase() === 'FINALIZADO'||
                                     selectedMarker.estado?.toUpperCase() === 'NOEXITOSO'    }"
        >
          <span *ngIf="selectedMarker.estado?.toUpperCase() === 'DISPONIBLE'">
            Estado: <strong>DISPONIBLE</strong> (Ofrecida por {{ selectedMarker.usuario }})
          </span>
          <span *ngIf="selectedMarker.estado?.toUpperCase() === 'TOMADO'">
            Estado: <strong>TOMADO</strong> por {{ selectedMarker.tomadoPor || 'un diligenciador' }}
          </span>
          <span *ngIf="selectedMarker.estado?.toUpperCase() === 'FINALIZADO'">
            Estado: <strong>FINALIZADO</strong>
          </span>
          <span *ngIf="selectedMarker.estado?.toUpperCase() === 'NOEXITOSO'">
            Estado: <strong>NO EXITOSO</strong>
          </span>
        </div>

        <!-- CONTENEDOR DE ACCIONES (Tomar/Finalizar/Editar/Eliminar) -->
        <div class="marker-actions mt-3">
          <!-- ACCIN PARA TOMAR SOLICITUD (Solo si est谩 disponible y NO soy el due帽o) -->
          <button
            *ngIf="
              selectedMarker.estado?.toUpperCase() === 'DISPONIBLE' &&
              selectedMarker.usuario !== currentUser?.username
            "
            class="btn btn-outline-info"
            (click)="takeMarker(selectedMarker!)"
          >
             Tomar Solicitud
          </button>

          <!-- ACCIN PARA FINALIZAR SOLICITUD (Solo si est谩 tomado por el usuario actual) -->

          <div class="btn-group" role="group" aria-label="Basic mixed styles example">
            <button
              *ngIf="
                selectedMarker.estado?.toUpperCase() === 'TOMADO' &&
                selectedMarker.tomadoPor !== currentUser?.username
              "
              class="btn btn-outline-primary"
              (click)="finishMarker(selectedMarker!)"
              type="button"
            >
              Finalizado
            </button>

            <button
              *ngIf="
                selectedMarker.estado?.toUpperCase() === 'TOMADO' &&
                selectedMarker.tomadoPor !== currentUser?.username
              "
              class="btn btn-outline-secondary"
              (click)="noFinishMarker(selectedMarker!)"
              type="button"
            >
              No Finalizado
            </button>
          </div>

          <!-- ACCIN DEL PROPIETARIO (Editar/Eliminar) -->
          <ng-container
            *ngIf="
              selectedMarker.usuario === currentUser?.username &&
              selectedMarker.estado?.toUpperCase() === 'DISPONIBLE'
            "
          >
            <div class="btn-group" role="group" aria-label="Basic mixed styles example">
              <button
                type="button"
                class="btn btn-outline-primary"
                (click)="editMarker(selectedMarker!)"
              >
                Editar
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary"
                (click)="deleteMarker(selectedMarker!)"
              >
                Eliminar
              </button>
            </div>
          </ng-container>

          <!-- MENSAJE DE ESTADO (si no hay bot贸n de acci贸n) -->
        </div>
      </div>
    </map-info-window>
  </google-map>
  <!-- MURO: FORMULARIO DE CREACIN/EDICIN -->
  <div >
    <app-muro
      *ngIf="mostrarMuro"
      [marker]="markerBeingEdited"
      [coordenadasEntrada]="newLocationData"
      (markerUpdated)="onMarkerUpdated($event)"
      (mostrarMapaEvent)="onMostrarMapa()"
    ></app-muro>
 </div>
 <div class="banner">
    <div class="dap-banner">
      <div class="dap-left">
      <img src="logo.png"  class="dap-logo" />
      </div>
      <div class="dap-right">
        <h2 class="dap-headline">Optimiza tus diligencias con DiligenciApp Pro</h2>
        <p class="dap-subheadline">La herramienta que organiza tu tiempo.</p>
        <a href="#" class="dap-cta">Accede ahora y obt茅n beneficios exclusivos</a>
      </div>
    </div>
  </div>
