<div class="map-container">
  <div class="header">
    <div class="brand">
      <h1>🌍 DiligenciApp</h1>
      <p>Diligencias y Servicios</p>
    </div>

    <div class="controls">
      <button class="refresh-btn" (click)="loadMarkers()" title="Recargar marcadores">🔄</button>
      <button class="toggle-btn" (click)="toggleVista()" title="Alternar vista">
        {{ mostrarMuro ? '🗺️ Ver mapa' : '🧱 Ver muro' }}
      </button>
            <button class="logout-btn" (click)="logout()" title="Cerrar sesión">X</button>

    </div>
  </div>

  <google-map
    *ngIf="mostrarMapa"
    height="450px"
    width="100%"
    [options]="mapOptions"
    [center]="center"
    [zoom]="zoom"
  >
    <map-marker
      *ngFor="let marker of markerPositions; trackBy: trackByMarkerId"
      #markerElem="mapMarker"
      [position]="{ lat: marker.lat, lng: marker.lng }"
      [title]="marker.titulo"
      (mapClick)="openInfoWindow(marker, markerElem, infoWindow)"
    ></map-marker>

    <map-info-window #infoWindow="mapInfoWindow">
      <div class="info-window" *ngIf="selectedMarker">
        <strong>{{ selectedMarker.titulo }}</strong
        ><br />
        <span>{{ selectedMarker.servicio }}</span
        ><br />
        <span>{{ selectedMarker.telefono }}</span
        ><br />
        <small>{{ selectedMarker.direccion }}</small>
        <div class="marker-actions" *ngIf="selectedMarker?.usuario === currentUser?.username">
          <button class="btn-edit" (click)="editMarker(selectedMarker)">✏️ Editar</button>
          <button class="btn-delete" (click)="deleteMarker(selectedMarker)">🗑️ Eliminar</button>
        </div>
      </div>
    </map-info-window>
  </google-map>

  <div class="muro-container">
    <app-muro
      *ngIf="mostrarMuro"
      [coordenadasEntrada]="newLocationData"
      [marker]="markerBeingEdited"
      (markerUpdated)="onMarkerUpdated($event)"
      (mostrarMapaEvent)="onMostrarMapa()"
    ></app-muro>
  </div>
</div>
